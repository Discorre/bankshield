{"ast":null,"code":"import React,{useState,useEffect}from'react';import{BrowserRouter as Router,Routes,Route}from'react-router-dom';import Header from'./components/Header';import Home from'./pages/Home';import Login from'./pages/Login';import Register from'./pages/Register';import Cart from'./pages/Cart';import ServiceDetails from'./pages/ServiceDetails';import ChangePassword from'./pages/ChangePassword';import ProtectedRoute from\"./components/ProtectedRoute\";import{ClipLoader}from'react-spinners';import api from'./api/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const CartContext=/*#__PURE__*/React.createContext();function App(){const[cartItems,setCartItems]=useState([]);const[user,setUser]=useState(null);const[token,setToken]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{setTimeout(()=>{const savedUser=localStorage.getItem('user');const savedToken=localStorage.getItem('token');if(savedUser&&savedToken){setUser(JSON.parse(savedUser));setToken(savedToken);}setLoading(false);},1000);},[]);const saveAuth=(userData,jwt)=>{setUser(userData);setToken(jwt);localStorage.setItem('user',JSON.stringify(userData));localStorage.setItem('token',jwt);};const logout=async()=>{//const token = localStorage.getItem('accessToken');\n//const refresh_token = localStorage.getItem('refreshToken');\ntry{await api.post('http://localhost:8000/api/v1/logout',{},{headers:{'refresh-token':localStorage.getItem('refreshToken')}});// Очищаем токен на клиенте\nlocalStorage.removeItem('accessToken');localStorage.removeItem('user');// Перенаправление или сообщение\nwindow.location.href='/';}catch(error){var _error$response;console.error('Ошибка при выходе:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-screen w-screen fixed top-0 left-0\",children:/*#__PURE__*/_jsx(ClipLoader,{size:500,color:\"#123abc\",loading:loading})});}return/*#__PURE__*/_jsx(CartContext.Provider,{value:{cartItems,setCartItems,user,token,saveAuth,logout},children:/*#__PURE__*/_jsxs(Router,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Home,{})}),/*#__PURE__*/_jsx(Route,{path:\"/service/:id\",element:/*#__PURE__*/_jsx(ServiceDetails,{})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:/*#__PURE__*/_jsx(Login,{})}),/*#__PURE__*/_jsx(Route,{path:\"/register\",element:/*#__PURE__*/_jsx(Register,{})}),/*#__PURE__*/_jsx(Route,{path:\"/cart\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(Cart,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/change_password\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(ChangePassword,{})})})]})]})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","Router","Routes","Route","Header","Home","Login","Register","Cart","ServiceDetails","ChangePassword","ProtectedRoute","ClipLoader","api","jsx","_jsx","jsxs","_jsxs","CartContext","createContext","App","cartItems","setCartItems","user","setUser","token","setToken","loading","setLoading","setTimeout","savedUser","localStorage","getItem","savedToken","JSON","parse","saveAuth","userData","jwt","setItem","stringify","logout","post","headers","removeItem","window","location","href","error","_error$response","console","response","data","message","className","children","size","color","Provider","value","path","element"],"sources":["/home/discorre/vscodeproj/123/bankshield/bankshield-client/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport Header from './components/Header';\nimport Home from './pages/Home';\nimport Login from './pages/Login';\nimport Register from './pages/Register';\nimport Cart from './pages/Cart';\nimport ServiceDetails from './pages/ServiceDetails';\nimport ChangePassword from './pages/ChangePassword';\nimport ProtectedRoute from \"./components/ProtectedRoute\";\nimport { ClipLoader } from 'react-spinners';\nimport api from './api/api';\n\nexport const CartContext = React.createContext();\n\nfunction App() {\n  const [cartItems, setCartItems] = useState([]);\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    setTimeout(() => {\n      const savedUser = localStorage.getItem('user');\n      const savedToken = localStorage.getItem('token');\n      if (savedUser && savedToken) {\n        setUser(JSON.parse(savedUser));\n        setToken(savedToken);\n      }\n      setLoading(false);\n    }, 1000);\n  }, []);\n\n  const saveAuth = (userData, jwt) => {\n    setUser(userData);\n    setToken(jwt);\n    localStorage.setItem('user', JSON.stringify(userData));\n    localStorage.setItem('token', jwt);\n  };\n\n  const logout = async () => {\n    //const token = localStorage.getItem('accessToken');\n    //const refresh_token = localStorage.getItem('refreshToken');\n\n    try {\n      await api.post('http://localhost:8000/api/v1/logout', {}, {\n        headers: {\n          'refresh-token': localStorage.getItem('refreshToken')\n        }\n      });\n  \n      // Очищаем токен на клиенте\n      localStorage.removeItem('accessToken');\n      localStorage.removeItem('user');\n  \n      // Перенаправление или сообщение\n      window.location.href = '/';\n    } catch (error) {\n      console.error('Ошибка при выходе:', error.response?.data || error.message);\n    }\n  };\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-screen w-screen fixed top-0 left-0\">\n        <ClipLoader size={500} color={\"#123abc\"} loading={loading} />\n      </div>\n    );\n  }\n\n  return (\n    <CartContext.Provider value={{ cartItems, setCartItems, user, token, saveAuth, logout }}>\n      <Router>\n        <Header />\n        <Routes>\n          <Route path=\"/\" element={<Home />} />\n          <Route path=\"/service/:id\" element={<ServiceDetails />} />\n          <Route path=\"/login\" element={<Login />} />\n          <Route path=\"/register\" element={<Register />} /> \n          <Route \n            path=\"/cart\"\n            element={<ProtectedRoute>\n              <Cart />\n            </ProtectedRoute>} />\n          <Route \n            path=\"/change_password\"\n            element={<ProtectedRoute><ChangePassword /></ProtectedRoute>} />\n        </Routes>\n      </Router>\n    </CartContext.Provider>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}